<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ripley Weather ‚Ä¢ Dashboard (Reset)</title>
<style>
  :root{
    --bg:#0b1a2b; --panel:#0f2742; --panel2:#0c2035; --accent:#4dc3ff; --bevel:#1c3a5e;
    --text:#eaf5ff; --muted:#aaccdd; --chip:#183958; --line:#204566;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1a2b,#07121e 70%);color:var(--text);
       font:400 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;display:flex;gap:10px;align-items:center;justify-content:space-between;
         padding:10px 14px;background:linear-gradient(180deg,#153a60,#102f50);border-bottom:2px solid var(--bevel)}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:34px;height:34px;border-radius:6px;background:linear-gradient(135deg,#1f7bb0,#144b78);
        display:grid;place-items:center;font-weight:800;color:#fff;box-shadow:inset 0 0 0 2px #09243c}
  main{max-width:1100px;margin:0 auto;padding:18px}
  section{background:linear-gradient(180deg,var(--panel),var(--panel2));border:2px solid var(--bevel);
          border-right-color:#2b69a1;border-bottom-color:#2b69a1;border-radius:10px;padding:12px;margin:12px 0}
  .bar{margin:-12px -12px 10px;padding:10px 12px;background:linear-gradient(180deg,#2a5e91,#1d4a74);
       border-bottom:2px solid #0e2f51;border-top-left-radius:8px;border-top-right-radius:8px;font-weight:800}
  table{width:100%;border-collapse:collapse;background:#0e2137;border:1px solid #244a71}
  thead th{background:#1a426b;color:#eaf5ff;padding:8px}
  td{padding:8px;border-top:1px solid #1b3f63}
  .muted{color:var(--muted)}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:#154b76;border:1px solid #2c79b1;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
  button:hover{filter:brightness(1.1)}
  .chip{background:var(--chip);border:1px solid #2b5c89;border-radius:8px;padding:4px 8px}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">WX</div>
      <div>
        <div style="font-weight:800;">Ripley Weather</div>
        <div id="runStamp" class="muted" style="font-size:.9rem;">Loading‚Ä¶</div>
      </div>
    </div>
    <div class="controls">
      <span id="buildId" class="chip">build: reset-1</span>
      <button id="btnRefresh" title="Force refresh from source">‚Üª Refresh</button>
    </div>
  </header>

  <main>
    <h1 id="runTitle" style="margin:0 0 8px;font-size:1.25rem;">Current Ripley, OH Weather Outlook</h1>

    <section id="quick"><div class="bar">üîé Quick Look</div><div id="quickHtml">Loading‚Ä¶</div></section>
    <section id="cards"><div class="bar">üìã Key Cards</div><div id="cardsHtml">Loading‚Ä¶</div></section>
    <section id="seven"><div class="bar">üìÜ 7-Day Outlook</div><div id="sevenHtml">Loading‚Ä¶</div></section>
    <section id="day"><div class="bar">üïí 24-Hour Planner</div><div id="plannerHtml">Loading‚Ä¶</div></section>
    <section id="trends"><div class="bar">üìà Trends & Diagnostics</div><div id="trendsHtml">Loading‚Ä¶</div></section>
    <section id="severe"><div class="bar">‚õà Severe Weather</div><div id="severeHtml">Loading‚Ä¶</div></section>
    <section id="radar"><div class="bar">üõ∞ Radar & Satellite</div><div id="radarHtml">Loading‚Ä¶</div></section>
    <section id="lightning"><div class="bar">‚ö° Lightning</div><div id="lightningHtml">Loading‚Ä¶</div></section>
    <section id="alerts"><div class="bar">‚ö†Ô∏è Alerts & Hazards</div><div id="alertsHtml">Loading‚Ä¶</div></section>
    <section id="air"><div class="bar">üå¨ Air & Health</div><div id="airHtml">Loading‚Ä¶</div></section>
    <section id="local"><div class="bar">üè´ Local Impacts</div><div id="localHtml">Loading‚Ä¶</div></section>
    <section id="rivers"><div class="bar">üåä Rivers & Streams</div><div id="riversHtml">Loading‚Ä¶</div></section>
    <section id="records"><div class="bar">üìä Climatology & Records</div><div id="recordsHtml">Loading‚Ä¶</div></section>
    <section id="astro"><div class="bar">üåå Astronomy & Skywatch</div><div id="astroHtml">Loading‚Ä¶</div></section>
    <section id="bottom"><div class="bar">‚úÖ Bottom Line</div><div id="bottomHtml">Loading‚Ä¶</div></section>
  </main>

<script>
  // ======== CONFIG: your Apps Script /exec URL ========
  const EXEC_URL = 'https://script.google.com/macros/s/AKfycbzX3n57oNJtWX9lUOvk1O4u2InY7PxMOKM67H4qJl_3cp-MraI3-B08m2j9VbnBjRsa6w/exec';

  // A monotonically increasing build id to defeat hard caches when you redeploy the page.
  const BUILD_ID = 'reset-1';

  // JSONP loader with cache-buster
  function loadReportJSONP() {
    return new Promise((resolve, reject) => {
      const cb = 'renderReport';
      const ts = Date.now();
      const s  = document.createElement('script');
      s.src = `${EXEC_URL}?callback=${cb}&t=${ts}`;
      s.async = true;
      s.onerror = () => reject(new Error('JSONP failed to load'));
      window[cb] = (payload) => { resolve(payload); try{ delete window[cb]; }catch(_){}; document.head.removeChild(s); };
      document.head.appendChild(s);
    });
  }

  function setHTML(id, html) {
    const el = document.getElementById(id);
    if (el) el.innerHTML = html || '‚Äî';
  }

  async function hydrate() {
    document.getElementById('buildId').textContent = `build: ${BUILD_ID}`;
    try {
      const rpt = await loadReportJSONP();
      document.title = rpt?.meta?.runTitle || 'Ripley Weather ‚Ä¢ Dashboard';
      document.getElementById('runTitle').textContent = rpt?.meta?.runTitle || 'Current Ripley, OH Weather Outlook';
      document.getElementById('runStamp').textContent = `${rpt?.meta?.runTime || '‚Äî'} ‚Ä¢ #${rpt?.meta?.totalToday || '‚Äî'}`;

      setHTML('quickHtml',     rpt.quick);
      setHTML('cardsHtml',     rpt.cards);
      setHTML('sevenHtml',     rpt.sevenDay);
      setHTML('plannerHtml',   rpt.hourly);
      setHTML('trendsHtml',    rpt.trends);
      setHTML('severeHtml',    rpt.severe);
      setHTML('radarHtml',     rpt.radar);
      setHTML('lightningHtml', rpt.lightning);
      setHTML('alertsHtml',    rpt.alerts);
      setHTML('airHtml',       rpt.air);
      setHTML('localHtml',     rpt.local);
      setHTML('riversHtml',    rpt.rivers);
      setHTML('recordsHtml',   rpt.records);
      setHTML('astroHtml',     rpt.astro);
      setHTML('bottomHtml',    rpt.bottom);
    } catch (err) {
      document.getElementById('runStamp').textContent = 'Failed to fetch data.';
      console.error(err);
    }
  }

  document.getElementById('btnRefresh').addEventListener('click', hydrate);

  // initial load
  hydrate();
</script>
</body>
</html>
